.nh
.TH "DBBACKUP" "1" "Feb 2026" "dbbackup" "Database Backup Tool"

.SH NAME
dbbackup-cleanup - Clean up old backups based on retention policy


.SH SYNOPSIS
\fBdbbackup cleanup [backup-directory] [flags]\fP


.SH DESCRIPTION
Remove old backup files based on retention policy while maintaining minimum backup count.

.PP
The retention policy ensures:
1. Backups older than --retention-days are eligible for deletion
2. At least --min-backups most recent backups are always kept
3. Both conditions must be met for deletion

.PP
GFS (Grandfather-Father-Son) Mode:
When --gfs flag is enabled, a tiered retention policy is applied:
- Yearly: Keep one backup per year on the first eligible day
- Monthly: Keep one backup per month on the specified day
- Weekly: Keep one backup per week on the specified weekday
- Daily: Keep most recent daily backups

.PP
Examples:
  # Clean up backups older than 30 days (keep at least 5)
  dbbackup cleanup /backups --retention-days 30 --min-backups 5

.PP
# Dry run to see what would be deleted
  dbbackup cleanup /backups --retention-days 7 --dry-run

.PP
# Clean up specific database backups only
  dbbackup cleanup /backups --pattern "mydb_*.dump"

.PP
# GFS retention: 7 daily, 4 weekly, 12 monthly, 3 yearly
  dbbackup cleanup /backups --gfs --gfs-daily 7 --gfs-weekly 4 --gfs-monthly 12 --gfs-yearly 3

.PP
# GFS with custom weekly day (Saturday) and monthly day (15th)
  dbbackup cleanup /backups --gfs --gfs-weekly-day Saturday --gfs-monthly-day 15

.PP
# Aggressive cleanup (keep only 3 most recent)
  dbbackup cleanup /backups --retention-days 1 --min-backups 3


.SH OPTIONS
\fB--dry-run\fP[=false]
	Show what would be deleted without actually deleting

.PP
\fB--gfs\fP[=false]
	Enable GFS (Grandfather-Father-Son) retention policy

.PP
\fB--gfs-daily\fP=7
	Number of daily backups to keep (GFS mode)

.PP
\fB--gfs-monthly\fP=12
	Number of monthly backups to keep (GFS mode)

.PP
\fB--gfs-monthly-day\fP=1
	Day of month for monthly backups (1-28)

.PP
\fB--gfs-weekly\fP=4
	Number of weekly backups to keep (GFS mode)

.PP
\fB--gfs-weekly-day\fP="Sunday"
	Day of week for weekly backups (e.g., 'Sunday')

.PP
\fB--gfs-yearly\fP=3
	Number of yearly backups to keep (GFS mode)

.PP
\fB-h\fP, \fB--help\fP[=false]
	help for cleanup

.PP
\fB--min-backups\fP=5
	Always keep at least this many backups

.PP
\fB--pattern\fP=""
	Only clean up backups matching this pattern (e.g., 'mydb_*.dump')

.PP
\fB--retention-days\fP=30
	Delete backups older than this many days


.SH OPTIONS INHERITED FROM PARENT COMMANDS
\fB--allow-root\fP[=false]
	Allow running as root/Administrator

.PP
\fB--auto-detect-cores\fP[=true]
	Auto-detect CPU cores

.PP
\fB--backup-dir\fP="/root/db_backups"
	Backup directory

.PP
\fB--check-resources\fP[=true]
	Check system resource limits

.PP
\fB--compression\fP=6
	Compression level (0-9)

.PP
\fB-c\fP, \fB--config\fP=""
	Path to config file (default: .dbbackup.conf in current directory)

.PP
\fB--cpu-workload\fP="balanced"
	CPU workload type (cpu-intensive|io-intensive|balanced)

.PP
\fB--database\fP="postgres"
	Database name

.PP
\fB-d\fP, \fB--db-type\fP="postgres"
	Database type (postgres|mysql|mariadb)

.PP
\fB--debug\fP[=false]
	Enable debug logging

.PP
\fB--debug-locks\fP[=false]
	Enable detailed lock debugging (captures PostgreSQL lock configuration, Large DB Guard decisions, boost attempts)

.PP
\fB--dump-jobs\fP=8
	Number of parallel dump jobs

.PP
\fB--fallback-tools\fP[=true]
	Fallback to external tools if native engine fails

.PP
\fB--host\fP="localhost"
	Database host

.PP
\fB--insecure\fP[=false]
	Disable SSL (shortcut for --ssl-mode=disable)

.PP
\fB--jobs\fP=16
	Number of parallel jobs

.PP
\fB--max-cores\fP=32
	Maximum CPU cores to use

.PP
\fB--max-retries\fP=3
	Maximum connection retry attempts

.PP
\fB--native\fP[=true]
	Use pure Go native engines (no external tools)

.PP
\fB--native-debug\fP[=false]
	Enable detailed native engine debugging

.PP
\fB--native-engine\fP[=true]
	Use pure Go native engines (alias for --native)

.PP
\fB--no-color\fP[=false]
	Disable colored output

.PP
\fB--no-config\fP[=false]
	Don't load configuration from .dbbackup.conf

.PP
\fB--no-save-config\fP[=false]
	Don't save configuration after successful operations

.PP
\fB--port\fP=5432
	Database port

.PP
\fB--socket\fP=""
	Unix socket path for MySQL/MariaDB (e.g., /var/run/mysqld/mysqld.sock)

.PP
\fB--ssl-mode\fP="prefer"
	SSL mode for connections

.PP
\fB--user\fP="postgres"
	Database user


.SH SEE ALSO
\fBdbbackup(1)\fP


.SH HISTORY
14-Feb-2026 Auto generated by spf13/cobra
