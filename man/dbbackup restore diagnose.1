.nh
.TH "DBBACKUP" "1" "Feb 2026" "dbbackup" "Database Backup Tool"

.SH NAME
dbbackup-restore-diagnose - Diagnose backup file integrity and format


.SH SYNOPSIS
\fBdbbackup restore diagnose [archive-file] [flags]\fP


.SH DESCRIPTION
Perform deep analysis of backup files to detect issues before restore.

.PP
This command validates backup archives and provides detailed diagnostics
including truncation detection, format verification, and COPY block integrity.

.PP
Use this when:
  - Restore fails with syntax errors
  - You suspect backup corruption or truncation
  - You want to verify backup integrity before restore
  - Restore reports millions of errors

.PP
Checks performed:
  - File format detection (custom dump vs SQL)
  - PGDMP signature verification
  - Compression integrity validation (pgzip)
  - COPY block termination check
  - pg_restore --list verification
  - Cluster archive structure validation

.PP
Examples:
  # Diagnose a single dump file
  dbbackup restore diagnose mydb.dump.gz

.PP
# Diagnose with verbose output
  dbbackup restore diagnose mydb.sql.gz --verbose

.PP
# Diagnose cluster archive and all contained dumps
  dbbackup restore diagnose cluster_backup.tar.gz --deep

.PP
# Output as JSON for scripting
  dbbackup restore diagnose mydb.dump --json


.SH OPTIONS
\fB--deep\fP[=false]
	For cluster archives, extract and diagnose all contained dumps

.PP
\fB-h\fP, \fB--help\fP[=false]
	help for diagnose

.PP
\fB--json\fP[=false]
	Output diagnosis as JSON

.PP
\fB--keep-temp\fP[=false]
	Keep temporary extraction directory (for debugging)

.PP
\fB--verbose\fP[=false]
	Show detailed analysis progress


.SH OPTIONS INHERITED FROM PARENT COMMANDS
\fB--allow-root\fP[=false]
	Allow running as root/Administrator

.PP
\fB--auto-detect-cores\fP[=true]
	Auto-detect CPU cores

.PP
\fB--backup-dir\fP="/root/db_backups"
	Backup directory

.PP
\fB--check-resources\fP[=true]
	Check system resource limits

.PP
\fB--compression\fP=6
	Compression level (0-9)

.PP
\fB-c\fP, \fB--config\fP=""
	Path to config file (default: .dbbackup.conf in current directory)

.PP
\fB--cpu-workload\fP="balanced"
	CPU workload type (cpu-intensive|io-intensive|balanced)

.PP
\fB--database\fP="postgres"
	Database name

.PP
\fB-d\fP, \fB--db-type\fP="postgres"
	Database type (postgres|mysql|mariadb)

.PP
\fB--debug\fP[=false]
	Enable debug logging

.PP
\fB--debug-locks\fP[=false]
	Enable detailed lock debugging (captures PostgreSQL lock configuration, Large DB Guard decisions, boost attempts)

.PP
\fB--dump-jobs\fP=8
	Number of parallel dump jobs

.PP
\fB--fallback-tools\fP[=true]
	Fallback to external tools if native engine fails

.PP
\fB--host\fP="localhost"
	Database host

.PP
\fB--insecure\fP[=false]
	Disable SSL (shortcut for --ssl-mode=disable)

.PP
\fB--jobs\fP=16
	Number of parallel jobs

.PP
\fB--max-cores\fP=32
	Maximum CPU cores to use

.PP
\fB--max-retries\fP=3
	Maximum connection retry attempts

.PP
\fB--min-backups\fP=5
	Minimum number of backups to keep

.PP
\fB--native\fP[=true]
	Use pure Go native engines (no external tools)

.PP
\fB--native-debug\fP[=false]
	Enable detailed native engine debugging

.PP
\fB--native-engine\fP[=true]
	Use pure Go native engines (alias for --native)

.PP
\fB--no-color\fP[=false]
	Disable colored output

.PP
\fB--no-config\fP[=false]
	Don't load configuration from .dbbackup.conf

.PP
\fB--no-save-config\fP[=false]
	Don't save configuration after successful operations

.PP
\fB--port\fP=5432
	Database port

.PP
\fB--retention-days\fP=30
	Backup retention period in days (0=disabled)

.PP
\fB--socket\fP=""
	Unix socket path for MySQL/MariaDB (e.g., /var/run/mysqld/mysqld.sock)

.PP
\fB--ssl-mode\fP="prefer"
	SSL mode for connections

.PP
\fB--user\fP="postgres"
	Database user


.SH SEE ALSO
\fBdbbackup-restore(1)\fP


.SH HISTORY
13-Feb-2026 Auto generated by spf13/cobra
