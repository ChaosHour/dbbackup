.nh
.TH "DBBACKUP" "1" "Feb 2026" "dbbackup" "Database Backup Tool"

.SH NAME
dbbackup-restore-benchmark - Benchmark restore performance and diagnose bottlenecks


.SH SYNOPSIS
\fBdbbackup restore-benchmark [flags]\fP


.SH DESCRIPTION
Benchmark restore performance to identify speed bottlenecks.

.PP
This command provides several diagnostic modes:

.PP
diagnose    Run diagnostic checks during an active restore
  compare     Compare psql vs native engine speed (identifies if bottleneck is in our code)
  pipeline    Test the pipeline restore engine (decoupled scanner architecture)

.PP
The benchmark helps answer: "Why is restore stuck at 21 MB/s?"

.PP
Common bottlenecks identified:
  - Scanner serialization (old engine feeds one table at a time)
  - fsync=on (2-5x slower than off for bulk load)
  - Buffer sizes too small (256KB â†’ 4MB for SSD)
  - Underutilized connection pool (workers idle)

.PP
Examples:
  # Quick benchmark: compare psql vs native engine
  dbbackup restore-benchmark compare --file backup.sql.gz --database testdb

.PP
# Test pipeline engine
  dbbackup restore-benchmark pipeline --file backup.sql.gz --database testdb --jobs 16

.PP
# Run diagnostics on a live restore (connect to running pprof server)
  dbbackup restore-benchmark diagnose --database testdb

.PP
# Full performance analysis
  dbbackup restore-benchmark compare --file backup.sql.gz --database testdb --jobs 8 --pprof


.SH OPTIONS
\fB-h\fP, \fB--help\fP[=false]
	help for restore-benchmark


.SH OPTIONS INHERITED FROM PARENT COMMANDS
\fB--allow-root\fP[=false]
	Allow running as root/Administrator

.PP
\fB--auto-detect-cores\fP[=true]
	Auto-detect CPU cores

.PP
\fB--backup-dir\fP="/root/db_backups"
	Backup directory

.PP
\fB--check-resources\fP[=true]
	Check system resource limits

.PP
\fB--compression\fP=6
	Compression level (0-9)

.PP
\fB-c\fP, \fB--config\fP=""
	Path to config file (default: .dbbackup.conf in current directory)

.PP
\fB--cpu-workload\fP="balanced"
	CPU workload type (cpu-intensive|io-intensive|balanced)

.PP
\fB--database\fP="postgres"
	Database name

.PP
\fB-d\fP, \fB--db-type\fP="postgres"
	Database type (postgres|mysql|mariadb)

.PP
\fB--debug\fP[=false]
	Enable debug logging

.PP
\fB--debug-locks\fP[=false]
	Enable detailed lock debugging (captures PostgreSQL lock configuration, Large DB Guard decisions, boost attempts)

.PP
\fB--dump-jobs\fP=8
	Number of parallel dump jobs

.PP
\fB--fallback-tools\fP[=true]
	Fallback to external tools if native engine fails

.PP
\fB--host\fP="localhost"
	Database host

.PP
\fB--insecure\fP[=false]
	Disable SSL (shortcut for --ssl-mode=disable)

.PP
\fB--jobs\fP=16
	Number of parallel jobs

.PP
\fB--max-cores\fP=32
	Maximum CPU cores to use

.PP
\fB--max-retries\fP=3
	Maximum connection retry attempts

.PP
\fB--min-backups\fP=5
	Minimum number of backups to keep

.PP
\fB--native\fP[=true]
	Use pure Go native engines (no external tools)

.PP
\fB--native-debug\fP[=false]
	Enable detailed native engine debugging

.PP
\fB--native-engine\fP[=true]
	Use pure Go native engines (alias for --native)

.PP
\fB--no-color\fP[=false]
	Disable colored output

.PP
\fB--no-config\fP[=false]
	Don't load configuration from .dbbackup.conf

.PP
\fB--no-save-config\fP[=false]
	Don't save configuration after successful operations

.PP
\fB--port\fP=5432
	Database port

.PP
\fB--retention-days\fP=30
	Backup retention period in days (0=disabled)

.PP
\fB--socket\fP=""
	Unix socket path for MySQL/MariaDB (e.g., /var/run/mysqld/mysqld.sock)

.PP
\fB--ssl-mode\fP="prefer"
	SSL mode for connections

.PP
\fB--user\fP="postgres"
	Database user


.SH SEE ALSO
\fBdbbackup(1)\fP, \fBdbbackup-restore-benchmark-compare(1)\fP, \fBdbbackup-restore-benchmark-diagnose(1)\fP, \fBdbbackup-restore-benchmark-pipeline(1)\fP


.SH HISTORY
15-Feb-2026 Auto generated by spf13/cobra
